## USER STORY
As a Fire Inspector, I want to create a sharable calendar link for my inspections, so that I can sync my inspection schedule with my external calendar applications (Outlook, Google Calendar, Apple Calendar, etc.).

## DESCRIPTION
Fire inspectors need to manage their inspection schedules across multiple calendar platforms. By providing an iCal sharable link on the My Inspections page, inspectors can easily integrate their inspection appointments into their preferred calendar applications. This feature mirrors the existing functionality in the scheduling module (My Shifts) and extends it to the fire prevention inspection workflow.

The My Inspections page displays only the logged-in user's inspections, eliminating the complexity of multi-user calendar sharing or creating links for other users.

## MCP (CRITICAL DO NOT SKIP)
**USE MCP TO CONNECT TO JIRA TICKET URL (MANDATORY TO READ)** https://firstduedev.atlassian.net/browse/PRE-1883

## FEATURE
- Add calendar icon button to My Inspections page UI (placement per mockup)
- Build new iCal service for inspections (existing service cannot handle inspection data complexity)
- Map inspection data fields to iCal format (see Acceptance Criteria for field mapping)
- Include both initial inspections and re-inspections in the calendar feed
- Create tooltip text "Create link for external calendars" on hover
- Implement clipboard copy functionality for the generated URL
- Handle inspections with and without specific times (default to All Day when no time is listed)
- Include ALL inspection statuses (scheduled, completed, cancelled, in progress, etc.)
- Include inspection notes field in event description when populated
- Implement error handling with user-friendly messaging

## ACCEPTANCE CRITERIA
- Given I am on the My Inspections page, When I hover over the calendar icon, Then I see the tooltip "Create link for external calendars."
- Given I am on the My Inspections page, When I click the calendar icon, Then a modal opens displaying a sharable iCal URL with "Copy" and "Revoke Link" buttons (design shown in mockup).
- Given the modal is open with the iCal URL, When I click the "Copy" button, Then the URL is copied to my clipboard and I see a confirmation message "Link copied to clipboard."
- Given I have copied the iCal URL, When I paste it into any supported calendar application (Outlook desktop, Apple Calendar, Mozilla Thunderbird, Google Calendar, Yahoo Calendar, Outlook.com ), Then my scheduled inspections are imported with all required data fields and will stay synchronized with updates.
- Given I have scheduled inspections with re-inspections, When the calendar syncs, Then both initial inspections and their linked re-inspections (2nd, 3rd, or follow-up inspections) appear as separate calendar events with clear relationship indicators in the title.
- Given I have inspections of any status (scheduled, completed, cancelled, in progress, ready for review, or any other status in the system), When the calendar syncs, Then all inspections appear in my calendar with their current status indicated in the event title using the format "[Status]: [Inspection Type] - [Business Name]".
- Given an initial inspection exists, When it appears in the calendar, Then the event title follows the format "[Status]: [Inspection Type] - [Business Name]" (e.g., "Scheduled: Fire & Life Safety Inspection - ABC Restaurant").
- Given a re-inspection exists, When it appears in the calendar, Then the event title follows the format "[Status]: Re-inspection: [Original Inspection Type] - [Business Name]" (e.g., "Scheduled: Re-inspection: Fire & Life Safety Inspection - ABC Restaurant").
- Given an inspection has a scheduled time, When it appears in the calendar, Then the event uses the scheduled time in 24-hour format (HH:MM) with a default duration of 1 hour.
- Given an inspection has no scheduled time, When it appears in the calendar, Then the event defaults to All Day.
- Given an inspection has location data, When it appears in the calendar, Then the Location field contains the full address of the inspection site.

- Given an inspection has any of the following populated fields (Business Name, Address, Inspection Type, Assigned To, Fire Station, Notes), When it appears in the calendar, Then the event description includes only the populated fields in the format:
  - Business Name: [Business Name]
  - Address: [Full Address]
  - Inspection Type: [Inspection Type Name]
  - Assigned To: [Inspector Name or Team Name]
  - Fire Station: [Station Name/Number]
  - Notes: [Inspection Notes]

- Given an inspection has empty data fields (Business Name, Address, Inspection Type, Assigned To, Fire Station, Notes), When it appears in the calendar, Then those empty fields are omitted from the event description entirely.
- Given the modal is open with the iCal URL, When I click the "Revoke Link" button, Then the existing iCal URL is invalidated, the modal closes, and I see a confirmation message "Calendar link has been revoked."
- Given I have revoked a calendar link, When external calendar applications attempt to sync using the revoked URL, Then they receive an error indicating the link is no longer valid.
- Given the iCal generation fails, When I attempt to create a sharable link, Then I see the error message "Unable to generate calendar link. Please try again later or contact support if the problem persists."

## USER WORKFLOW
- User navigates to Inspections > My Inspections → System displays the user's inspection list with calendar icon
- User hovers over calendar icon → System shows tooltip "Create link for external calendars"
- User clicks calendar icon → System opens modal with sharable iCal URL and action buttons
- User clicks "Copy" button → System copies URL to clipboard and shows confirmation message
- User pastes URL into their preferred calendar application → Calendar application imports and syncs scheduled inspections
- (Optional) User clicks "Revoke Link" button → System invalidates the URL and shows confirmation message

## EXAMPLES
**MANDATORY** REVIEW PREVIOUS IMPLEMENTATION SPIKE
- Key Finding: The system already contains a fully functional iCal export implementation in the My Shifts module that serves as the architectural foundation.

**Existing My Shifts Implementation:**
- Controller: `ScheduleIcalExportController.php` - Handles shifts calendar exports
- Model: `ScheduleIcalExport.php` - Manages access tokens and export data
- Repository: `ScheduleIcalRepository.php` - Retrieves work shifts, rotations, and time-off data
- Frontend: `my_shifts_shareable_link_modal.js` - VanillaModal-based UI component
- Permission: `accessShiftMyShiftsModule` - Controls access to functionality

**Architectural Similarities:**
- Both implementations share the same foundational patterns:
- Token-based Security: UUIDv4 access tokens with revocation capability
- Multi-tenant Filtering: Automatic client_code-based data isolation
- Repository Pattern: Dedicated data access layer for optimized queries
- Modal UI: Shareable link generation and management interface